dist: xenial
language: python
python:
  - "3.4"
  - "3.5"
  - "3.6"
  - "3.7"

services:
  - docker

cache:
  - pip

install:
  - pip install -r requirements.txt
  - pip install pylint pycodestyle  # requirements only for CI
  - docker build -t selfhostingtools/imap2smtp:latest -f docker/Dockerfile .

script:
  - pylint --rcfile=.pylintrc imap2smtp.py docker/entrypoint.py
  - pycodestyle imap2smtp.py docker/entrypoint.py
  # - python -m unittest discover tests -v
  # - docker run --rm -it --entrypoint python selfhostingtools/imap2smtp:latest -m unittest discover tests -v

after_success:
  - echo $DOCKER_PASS | docker login -u selfhostingtools --password-stdin
  - docker push selfhostingtools/imap2smtp:latest

notifications:
  email:
    - secure: "ZEwr6AmOgQwXwlcXkKxYwTJlUP9cDwZVaI1l76XxqHckdX1YVPZEj6fCfORK1Kt39bdnVmgzkl+QQtKh6CfqGk1M8iSnh2H+cqDLa0wzys+0HI67l9XKnFeDAZKKQEHS0o0It4EfBhcJgZo2Ql0O6AHtvY5EM9O6uWPB6RKTjpCs8fLYi+VLwRwjC8ECqgc8qLT8/7R5TflfbbKKKqCizJEIXmdqX9oKIjRHv/x8G8LopOjxNtfBTguk8TKo5aph+JQk+m4AVlgZoECS739rB/bKsG43KZ6cmyA1q/hDIzgobUK6ouKtmM7S6jL4bTDItWKvChxXXyyb3FB7rpOsaogDF18U7E452P0X+vYdqN9vRYRZJZ3cBgpqC4TTTaqbXsjfP5LJB5eU49cegqjUc6OBq9MJtA3uh4yQ/ixvk1vspizbshWSkvGI+4tlW529YMWt3dxeqWvyIctvFCcvAMic2vTCqpjBusc+p3ZUAbes2CIiWPTGr4f0ktR9PV7rgvw5LbTE61AkNWzYYhxl8DgsUtvenJKmutdT4tRonqrWxLJsiHvsTj0NHC51FutPQJ3su89XAgW3V+2EwTeEMzWdWG0bwmnyzyA26TQG6ifJVkOcGbgr/wZL1KIiPnz4YynQs4oniYmseWD+V3ReOCMHVQ8zwe1zglI6Mb1++1w="
